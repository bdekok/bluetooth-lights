(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(t,e,n){t.exports=n(21)},20:function(t,e,n){},21:function(t,e,n){"use strict";n.r(e);var o=n(0),r=n.n(o),c=n(10),a=n.n(c),i=(n(20),n(1)),l=n(2),u=n(4),s=n(3),h=n(5),d=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this))).connect=function(){n.props.bulb.connect().then(function(){n.props.connectFunction(!0)}).catch(function(){n.props.connectFunction(!1)})},n}return Object(h.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return r.a.createElement("button",{onClick:this.connect},"Connect")}}]),e}(r.a.Component),f=function(t){for(var e=[],n=0;n<t.colors.length;n++)e.push(r.a.createElement(b,{key:t.colors[n].colorNr,colorNr:t.colors[n].colorNr,color:t.colors[n].color,changeColorFunction:t.changeColorFunction}));return e},b=function(t){function e(t){return Object(i.a)(this,e),Object(u.a)(this,Object(s.a)(e).call(this))}return Object(h.a)(e,t),Object(l.a)(e,[{key:"updateColor",value:function(t){this.props.changeColorFunction(this.props.colorNr,t.target.value)}},{key:"render",value:function(){var t=this;return r.a.createElement("input",{type:"color",value:this.props.color,onChange:function(e){return t.updateColor(e)}})}}]),e}(r.a.Component),v={name:[{namePrefix:"LED"}],service:52226,colorWriteCharacteristic:60931,colorReadCharacteristic:60929},C=function(){function t(){Object(i.a)(this,t),this._colorWriteCharacteristic=null,this._device=null}return Object(l.a)(t,[{key:"connect",value:function(){var t=this;return new Promise(function(e,n){navigator.bluetooth.requestDevice({filters:v.name,optionalServices:[v.service]}).then(function(e){return t._device=e,t._device.addEventListener("gattserverdisconnected",function(){return t.reconnectDevice()}),t.connectDevice()}).then(function(n){return t._colorWriteCharacteristic=t.getCharacteristic(n,v.colorWriteCharacteristic),e()}).catch(function(t){console.error(t),n(t)})})}},{key:"connectDevice",value:function(){return this._device.gatt.connect()}},{key:"reconnectDevice",value:function(){var t=this;this._colorWriteCharacteristic=null,this.connectDevice().then(function(e){t._colorWriteCharacteristic=t.getCharacteristic(e,v.colorWriteCharacteristic)})}},{key:"getCharacteristic",value:function(t,e){return t.getPrimaryService(v.service).then(function(t){return t.getCharacteristic(e)})}},{key:"changeColor",value:function(t,e,n){this._colorWriteCharacteristic&&this._device.gatt.connected&&(this._colorWriteCharacteristic=this._colorWriteCharacteristic.then(function(o){return o.writeValue(new Uint8Array([1,e,1,0,1,n,1,t,1,0])).then(function(){return o})}).catch(function(t){console.error("Argh! "+t)}))}}]),t}(),p=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this,t))).backgroundColor=r.a.createRef(),n.lastComputedColor="",n}return Object(h.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.updateCSSVariableColors(this.props.colors),this.timerID=setInterval(function(){return t.updateLight()},50)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerID)}},{key:"componentDidUpdate",value:function(t){this.updateCSSVariableColors(this.props.colors)}},{key:"updateCSSVariableColors",value:function(t){var e=this;t.forEach(function(t){e.backgroundColor.current.style.setProperty("--bg-color-".concat(t.colorNr),t.color)})}},{key:"updateLight",value:function(){var t=window.getComputedStyle(this.backgroundColor.current).backgroundColor,e=t.replace(/^rgba?\(|\s+|\)$/g,"").split(",");if(t!==this.lastComputedColor){this.lastComputedColor=t;var n=parseInt(e[0],10),o=parseInt(e[1],10),r=parseInt(e[2],10);this.props.updateBulbColor(n,o,r)}}},{key:"render",value:function(){var t="background-color background-color--length-".concat(this.props.colors.length);return r.a.createElement("div",{className:t,ref:this.backgroundColor})}}]),e}(r.a.Component),g=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this,t))).setConnection=function(t){n.setState({connected:t})},n.addColor=function(){n.setState(function(t){return t.colors.push({colorNr:t.colors.length+1,color:n.getRandomColor()})})},n.removeColor=function(){n.setState(function(t){return t.colors.splice(-1,1)})},n.setColors=function(t,e){n.setState(function(n){return n.colors.map(function(n){return n.colorNr===t?n.color=e:null})})},n.updateBulbColor=function(t,e,o){n.state.bulb.changeColor(t,e,o)},n.state={bulb:new C,connected:!1,colors:[{colorNr:1,color:n.getRandomColor()}]},n}return Object(h.a)(e,t),Object(l.a)(e,[{key:"getRandomColor",value:function(){for(var t="#",e=0;e<6;e++)t+="0123456789abcdef"[Math.floor(16*Math.random())];return t}},{key:"render",value:function(){return this.state.connected?r.a.createElement("div",{className:"bulb"},r.a.createElement("div",null,r.a.createElement(f,{colors:this.state.colors,changeColorFunction:this.setColors}),r.a.createElement(p,{colors:this.state.colors,updateBulbColor:this.updateBulbColor})),r.a.createElement("div",null,this.state.colors.length>1?r.a.createElement("button",{onClick:this.removeColor},"-"):"",this.state.colors.length<=5?r.a.createElement("button",{onClick:this.addColor},"+"):"")):r.a.createElement("div",{className:"bulb"},r.a.createElement("div",null,r.a.createElement(d,{bulb:this.state.bulb,connectFunction:this.setConnection})))}}]),e}(o.Component),m=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(u.a)(this,Object(s.a)(e).call(this))).addBulb=function(){n.setState(function(t){return{bulbCount:t.bulbCount+1}})},n.removeBulb=function(){n.setState(function(t){return{bulbCount:t.bulbCount-1}})},n.state={bulbCount:1},n}return Object(h.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){for(var t=[],e=0;e<this.state.bulbCount;e++)t.push(r.a.createElement(g,{key:e}));return r.a.createElement("div",null,r.a.createElement("div",{className:"container"},t),r.a.createElement("div",{className:"bulbControls"},this.state.bulbCount<4?r.a.createElement("button",{className:"add-button",onClick:this.addBulb},"Add Light"):"",this.state.bulbCount>1?r.a.createElement("button",{className:"add-button",onClick:this.removeBulb},"Remove Light"):""))}}]),e}(o.Component),k=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function w(t){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var e=t.installing;e.onstatechange=function(){"installed"===e.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(t){console.error("Error during service worker registration:",t)})}a.a.render(r.a.createElement(m,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/bluetooth-lights/demo",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/bluetooth-lights/demo","/service-worker.js");k?(function(t){fetch(t).then(function(e){404===e.status||-1===e.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):w(t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):w(t)})}}()}},[[11,1,2]]]);
//# sourceMappingURL=main.28e5a060.chunk.js.map